<!-- failuredetector_modal.jinja2 (Fully Implemented UI) -->
<div id="failure_report_modal" class="modal hide fade" tabindex="-1" role="dialog">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
        <h3 data-bind="text: modalTitle">Report Print Outcome</h3>
    </div>
    <div class="modal-body">

        <!-- Screen 1: "Did this print fail?" -->
        <div data-bind="visible: modalScreen() === 'confirm_failure'">
            <h4>Did this print fail?</h4>
            <p>Please review the final frame of your print.</p>
            <img data-bind="attr: { src: lastSnapshotUrl }" style="width: 100%; border-radius: 4px; margin-bottom: 15px; background-color: #222;" />
            <div class="text-center">
                <button class="btn btn-success btn-large" style="width: 45%;" data-bind="click: reportNo">No, it was a Success</button>
                <button class="btn btn-danger btn-large" style="width: 45%;" data-bind="click: reportYes">Yes, it Failed</button>
            </div>
        </div>

        <!-- Screen 2: "When did the failure start?" -->
        <div data-bind="visible: modalScreen() === 'select_frame'">
            <h4>When did the failure start?</h4>
            <p>Use the slider to select the first frame where the failure is visible.</p>
            <!-- ko if: timelapseFrames().length > 0 -->
            <img data-bind="attr: { src: selectedFrameUrl }" style="width: 100%; border-radius: 4px; background-color: #222;" />
            <input type="range" class="input-block-level" style="margin-top: 15px;"
                   data-bind="value: selectedFrameIndex, min: 0, max: timelapseFrames().length - 1, valueUpdate: 'input'">
            <p class="text-center" data-bind="text: selectedFramePath"></p>
            <!-- /ko -->
            <!-- ko if: timelapseFrames().length === 0 -->
            <div class="alert">Could not find any timelapse frames. Ensure timelapse is enabled.</div>
            <!-- /ko -->
            <hr>
            <label>Failure Type:</label>
            <select class="input-block-level" data-bind="options: failureTypes, value: selectedFailureType"></select>
        </div>

        <!-- Screen 3: "Draw Boxes over failure" (Functional Placeholder) -->
        <div data-bind="visible: modalScreen() === 'draw_boxes'">
            <h4>Draw Boxes Over Failure Area (Future Feature)</h4>
            <p>The ability to draw bounding boxes will be added in a future update. You can skip this step for now.</p>
            <div style="background-color:#222; padding:10px; border-radius: 4px;">
                <img data-bind="attr: { src: selectedFrameUrl }" style="width: 100%;" />
            </div>
        </div>

        <!-- Screen 4: "Confirm and Submit" -->
        <div data-bind="visible: modalScreen() === 'final_confirm'">
            <h4 data-bind="text: finalConfirmTitle"></h4>
            <p>Review the information below before submitting.</p>
            <div style="background-color:#222; padding:10px; border-radius: 4px;">
                <img data-bind="attr: { src: selectedFrameUrl }" style="width: 100%;" />
            </div>
            <p class="text-center" data-bind="text: finalFailureTypeText"></p>
            <hr>
            <label class="checkbox"><input type="checkbox" data-bind="checked: includePrintSettings"> Include print settings (temps, speeds, etc.)</label>
            <label class="checkbox"><input type="checkbox" data-bind="checked: acceptDataUse"> I agree this data can be used for AI training.</label>
        </div>
    </div>
    <div class="modal-footer" data-bind="visible: modalScreen() !== 'confirm_failure'">
        <button class="btn" data-bind="click: modalBack">Back</button>
        <button class="btn" data-dismiss="modal">Cancel</button>
        <button class="btn btn-primary" data-bind="click: modalConfirm, text: modalConfirmText, enable: modalConfirmEnabled"></button>
    </div>
</div>
