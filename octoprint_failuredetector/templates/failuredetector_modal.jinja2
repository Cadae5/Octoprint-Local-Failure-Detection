<!-- failuredetector_modal.jinja2 (Corrected Workflow Version) -->
<div id="failure_report_modal" class="modal hide fade" tabindex="-1" role="dialog">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
        <h3 data-bind="text: modalTitle">Report Print Outcome</h3>
    </div>
    <div class="modal-body">

        <!-- Screen 1: "Did this print fail?" -->
        <div data-bind="if: modalScreen() === 'confirm_failure'">
            <h4>Did this print fail?</h4>
            <p>Please review the final frame of your print.</p>
            <img data-bind="attr: { src: snapshotUrlWithCacheBuster }" style="width: 100%; border-radius: 4px; margin-bottom: 15px;" />
            <!-- Explicit Yes/No buttons for this screen -->
            <div class="text-center">
                <button class="btn btn-success btn-large" style="width: 45%;" data-bind="click: reportNo">No, it was a Success</button>
                <button class="btn btn-danger btn-large" style="width: 45%;" data-bind="click: reportYes">Yes, it Failed</button>
            </div>
        </div>

        <!-- Screen 2: "When did the failure start?" -->
        <div data-bind="if: modalScreen() === 'select_frame'">
            <!-- ... (This screen's content is unchanged) ... -->
        </div>

        <!-- Screen 3: "Draw Boxes over failure" -->
        <div data-bind="if: modalScreen() === 'draw_boxes'">
            <!-- ... (This screen's content is unchanged) ... -->
        </div>

        <!-- Screen 4: "Confirm and Submit" -->
        <div data-bind="if: modalScreen() === 'final_confirm'">
            <h4 data-bind="text: finalConfirmTitle"></h4>
            <p>Review the information below before submitting to the community database.</p>
            <!-- ... (The rest of this screen's content is unchanged) ... -->
        </div>

    </div>
    <!-- The main footer buttons are now hidden on the first screen -->
    <div class="modal-footer" data-bind="visible: modalScreen() !== 'confirm_failure'">
        <button class="btn" data-bind="click: modalBack">Back</button>
        <button class="btn" data-dismiss="modal" aria-hidden="true">Cancel</button>
        <button class="btn btn-primary" data-bind="click: modalConfirm, text: modalConfirmText, enable: modalConfirmEnabled"></button>
    </div>
</div>
